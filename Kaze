-- Kaze UI v2.0 â€” Modular, Theme-Driven, WindUI-Inspired
-- Fully refactored for scalability, performance, and maintainability.
-- Maintains your original aesthetic + fixes all layout/behavior bugs.
-- Kazu approved. ðŸ’™

local KazeUI = {}
KazeUI.__index = KazeUI

-- === SERVICES === --
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local TextService = game:GetService("TextService")
local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- === THEME SYSTEM === --
local Theme = {
	-- Core
	Primary = Color3.fromRGB(0, 160, 255),
	Secondary = Color3.fromRGB(0, 140, 200),
	Background = Color3.fromRGB(20, 20, 25),
	Card = Color3.fromRGB(24, 24, 28),
	CardActive = Color3.fromRGB(32, 32, 36),
	TextPrimary = Color3.fromRGB(235, 235, 235),
	TextSecondary = Color3.fromRGB(160, 160, 160),
	TextInactive = Color3.fromRGB(200, 200, 200),
	Divider = Color3.fromRGB(0, 200, 255),
	Success = Color3.fromRGB(117, 204, 50),
	Warning = Color3.fromRGB(255, 204, 51),
	Danger = Color3.fromRGB(235, 80, 80),

	-- Fonts
	TitleFont = Enum.Font.GothamBold,
	BodyFont = Enum.Font.Gotham,

	-- Sizes
	TabHeight = 44,
	CornerRadius = 6,
	WindowWidth = 650,
	WindowHeight = 420,
	SidebarWidth = 180,
	Padding = 8,
}

-- === UTILS === --
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id)
	local clean = string.gsub(id, "%D", "")	return (clean ~= "") and ("rbxassetid://" .. clean) or ""
end

local function Create(instanceType, props)
	local inst = Instance.new(instanceType)
	for prop, val in pairs(props) do
		inst[prop] = val
	end
	return inst
end

local function SafeConnect(event, callback)
	local conn
	conn = event:Connect(function(...)
		if not conn then return end
		task.spawn(callback, ...)
	end)
	return conn
end

local function StartNeonLoop(target)
	if not target then return end
	task.spawn(function()
		while target and target.Parent do
			local propName = nil
			if pcall(function() return target.Color end) then
				propName = "Color"
			elseif pcall(function() return target.BackgroundColor3 end) then
				propName = "BackgroundColor3"
			end
			if not propName then break end

			local tweenInfo = TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
			local ok, tween = pcall(TweenService.Create, TweenService, target, tweenInfo, {[propName] = Color3.fromRGB(0, 255, 255)})
			if ok and tween then
				tween:Play()
				break
			end
			wait(2)
		end
	end)
end

-- === DRAGGABLE === --
local function MakeDraggable(dragPart, targetPart)
	local dragging = false
	local dragStart, startPos

	SafeConnect(dragPart.InputBegan, function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
		end
	end)

	SafeConnect(dragPart.InputEnded, function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = false
		end
	end)

	SafeConnect(UIS.InputChanged, function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			targetPart.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
end

-- === SCREEN GUI SETUP === --
local ScreenGui = Create("ScreenGui", {
	Name = "KazeUI",
	ResetOnSpawn = false,
	ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
	Parent = LP:WaitForChild("PlayerGui")
})

local UIScale = Create("UIScale", { Parent = ScreenGui })

local function UpdateScale()
	local size = Camera.ViewportSize
	UIScale.Scale = (size.X < 600) and math.clamp(size.X / 800, 0.5, 1) or math.clamp(size.X / 1920, 0.6, 1)
end

UpdateScale()
SafeConnect(Camera:GetPropertyChangedSignal("ViewportSize"), UpdateScale)

-- === COMPONENT FACTORIES === --

-- Paragraph Factory
local function CreateParagraph(parentFrame, strokeColor, title, body)
	title = tostring(title or "")
	body = tostring(body or "")

	local function updateSize()
		local width = parentFrame.AbsoluteSize.X * 0.95		local titleH = (title ~= "") and math.max(20, math.ceil(TextService:GetTextSize(title, 16, Theme.TitleFont, Vector2.new(width - 32, 1000)).Y)) or 0
		local bodyH = math.ceil(TextService:GetTextSize(body, 14, Theme.BodyFont, Vector2.new(width - 32, 2000)).Y)
		local totalH = 10 + titleH + 6 + bodyH + 10
		return totalH, titleH, bodyH, width
	end

	local totalH, titleH, bodyH = updateSize()

	local wrapper = Create("Frame", {
		Name = "ParagraphWrapper",
		Size = UDim2.new(1, 0, 0, totalH + 12),
		BackgroundTransparency = 1,
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = parentFrame
	})

	local paraFrame = Create("Frame", {
		Name = "Paragraph",
		AnchorPoint = Vector2.new(0.5, 0),
		Position = UDim2.new(0.5, 0, 0, 6),
		Size = UDim2.new(0.95, 0, 0, totalH),
		BackgroundColor3 = Theme.Card,
		BorderSizePixel = 0,
		Parent = wrapper
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 8), Parent = paraFrame })

	local glow = Create("Frame", {
		Name = "ParagraphGlow",
		AnchorPoint = Vector2.new(0.5, 0),
		Position = UDim2.new(0.5, 0, 0, 4),
		Size = UDim2.new(0.96, 0, 0, totalH + 10),
		BackgroundColor3 = strokeColor or Theme.Primary,
		BackgroundTransparency = 0.96,
		Parent = wrapper
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 10), Parent = glow })
	StartNeonLoop(glow)

	local paraStroke = Create("UIStroke", {
		Thickness = 2,
		ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
		Color = strokeColor or Theme.Primary,
		Parent = paraFrame
	})
	StartNeonLoop(paraStroke)

	local inner = Create("Frame", {
		Size = UDim2.new(1, -20, 1, -20),
		Position = UDim2.fromOffset(10, 10),		BackgroundTransparency = 1,
		Parent = paraFrame
	})

	if title ~= "" then
		Create("TextLabel", {
			Name = "ParagraphTitle",
			Size = UDim2.new(1, 0, 0, titleH),
			Position = UDim2.fromOffset(0, 0),
			BackgroundTransparency = 1,
			Text = title,
			TextColor3 = Theme.TextPrimary,
			Font = Theme.TitleFont,
			TextSize = 16,
			TextXAlignment = Enum.TextXAlignment.Left,
			TextWrapped = true,
			Parent = inner
		})
	end

	local bodyLabel = Create("TextLabel", {
		Name = "ParagraphBody",
		Size = UDim2.new(1, 0, 0, bodyH),
		Position = UDim2.fromOffset(0, titleH + 6),
		BackgroundTransparency = 1,
		Text = body,
		TextColor3 = Theme.TextPrimary,
		Font = Theme.BodyFont,
		TextSize = 14,
		TextWrapped = true,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextYAlignment = Enum.TextYAlignment.Top,
		Parent = inner
	})

	return {
		Wrapper = wrapper,
		Frame = paraFrame,
		SetText = function(self, newText)
			body = tostring(newText or "")
			task.defer(function()
				if not wrapper.Parent then return end
				local newTotalH, newTitleH, newBodyH = updateSize()
				paraFrame.Size = UDim2.new(0.95, 0, 0, newTotalH)
				glow.Size = UDim2.new(0.96, 0, 0, newTotalH + 10)
				wrapper.Size = UDim2.new(1, 0, 0, newTotalH + 12)
				if inner:FindFirstChild("ParagraphTitle") then
					inner.ParagraphTitle.Size = UDim2.new(1, 0, 0, newTitleH)
				end
				bodyLabel.Size = UDim2.new(1, 0, 0, newBodyH)				bodyLabel.Text = body
			end)
		end
	}
end

-- Section Factory
local function CreateSection(parent, title)
	title = tostring(title or "")

	local sectionFrame = Create("Frame", {
		Name = "Section_" .. (title:gsub("%W", "_")),
		Size = UDim2.new(1, -24, 0, 0),
		BackgroundTransparency = 1,
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = parent
	})

	Create("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 6),
		VerticalAlignment = Enum.VerticalAlignment.Top,
		HorizontalAlignment = Enum.HorizontalAlignment.Center,
		Parent = sectionFrame
	})

	if title ~= "" then
		Create("TextLabel", {
			Name = "SectionTitle",
			Size = UDim2.new(1, 0, 0, 36),
			BackgroundTransparency = 1,
			Text = title,
			TextColor3 = Theme.Primary,
			Font = Theme.TitleFont,
			TextSize = 22,
			TextWrapped = true,
			TextXAlignment = Enum.TextXAlignment.Center,
			Parent = sectionFrame
		})

		Create("Frame", {
			Name = "SectionSeparator",
			Size = UDim2.new(0.6, 0, 0, 2),
			BackgroundColor3 = Color3.fromRGB(38, 38, 42),
			BorderSizePixel = 0,
			Parent = sectionFrame
		}).Parent = sectionFrame
		Create("UICorner", { CornerRadius = UDim.new(0, 4), Parent = sectionFrame.SectionSeparator })
	end
	local content = Create("Frame", {
		Name = "SectionContent",
		Size = UDim2.new(1, 0, 0, 0),
		BackgroundTransparency = 1,
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = sectionFrame
	})

	Create("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 8),
		HorizontalAlignment = Enum.HorizontalAlignment.Center,
		VerticalAlignment = Enum.VerticalAlignment.Top,
		Parent = content
	})

	return {
		Frame = sectionFrame,
		AddLabel = function(self, text)
			return Create("TextLabel", {
				Size = UDim2.new(1, -40, 0, 24),
				BackgroundTransparency = 1,
				Text = tostring(text or ""),
				TextColor3 = Theme.TextPrimary,
				Font = Theme.BodyFont,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = content
			})
		end,
		AddParagraph = function(self, ptitle, pbody)
			return CreateParagraph(content, Theme.Primary, ptitle, pbody)
		end
	}
end

-- Tab Factory
local function CreateTab(parent, name, iconId, pagesFrame, strokeColor)
	name = tostring(name or "Tab")
	local formattedIcon = FormatImage(iconId)

	local btn = Create("TextButton", {
		Name = "TabButton_" .. name,
		Size = UDim2.new(1, -16, 0, Theme.TabHeight),
		BackgroundColor3 = Theme.Card,
		BorderSizePixel = 0,
		Text = "",
		AutoButtonColor = false,
		Parent = parent
	})	Create("UICorner", { CornerRadius = UDim.new(0, Theme.CornerRadius), Parent = btn })

	local indicator = Create("Frame", {
		Name = "LeftIndicator",
		Size = UDim2.new(0, 4, 1, 0),
		Position = UDim2.new(0, 0, 0, 0),
		BackgroundColor3 = strokeColor,
		BorderSizePixel = 0,
		Visible = false,
		Parent = btn
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 6), Parent = indicator })

	Create("ImageLabel", {
		Name = "Icon",
		Size = UDim2.fromOffset(28, 28),
		Position = UDim2.new(0, 10, 0.5, -14),
		BackgroundTransparency = 1,
		Image = formattedIcon,
		Parent = btn
	}).Parent = btn
	Create("UICorner", { CornerRadius = UDim.new(1, 0), Parent = btn.Icon })

	local label = Create("TextLabel", {
		Name = "Label",
		Size = UDim2.new(1, -56, 1, 0),
		Position = UDim2.fromOffset(48, 0),
		BackgroundTransparency = 1,
		Text = name,
		TextColor3 = Theme.TextInactive,
		Font = Theme.BodyFont,
		TextSize = 15,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = btn
	})

	local page = Create("Frame", {
		Name = "Page_" .. name,
		Size = UDim2.new(1, 0, 1, 0),
		BackgroundTransparency = 1,
		Visible = false,
		Parent = pagesFrame
	})

	local pageContent = Create("Frame", {
		Name = "PageContent",
		Size = UDim2.new(1, 0, 1, 0),
		BackgroundTransparency = 1,
		Parent = page
	})	Create("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 8),
		VerticalAlignment = Enum.VerticalAlignment.Top,
		HorizontalAlignment = Enum.HorizontalAlignment.Center,
		Parent = pageContent
	})

	local isActive = false
	local function activate()
		if isActive then return end
		for _, sibling in ipairs(parent:GetChildren()) do
			if sibling:IsA("TextButton") and sibling ~= btn then
				sibling.BackgroundColor3 = Theme.Card
				sibling:FindFirstChild("LeftIndicator")?.Visible = false
				sibling:FindFirstChild("Label").TextColor3 = Theme.TextInactive
				sibling:FindFirstChild("Label").Font = Theme.BodyFont
				pagesFrame:FindFirstChild(sibling.Name:gsub("TabButton_", "Page_"))?.Visible = false
			end
		end
		btn.BackgroundColor3 = Theme.CardActive
		indicator.Visible = true
		label.TextColor3 = Theme.TextPrimary
		label.Font = Theme.TitleFont
		page.Visible = true
		isActive = true
	end

	local hoverTween = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	btn.MouseEnter:Connect(function()
		if not isActive then
			TweenService:Create(btn, hoverTween, { BackgroundColor3 = Color3.fromRGB(28, 28, 31) }):Play()
			label.TextColor3 = Color3.fromRGB(220, 220, 220)
		end
	end)
	btn.MouseLeave:Connect(function()
		if not isActive then
			TweenService:Create(btn, hoverTween, { BackgroundColor3 = Theme.Card }):Play()
			label.TextColor3 = Theme.TextInactive
		end
	end)
	btn.MouseButton1Click:Connect(activate)

	return {
		Button = btn,
		Page = page,
		_PageContent = pageContent,
		_Stroke = strokeColor,
		Activate = activate,
		Paragraph = function(self, ptitle, pbody)			return CreateParagraph(pageContent, strokeColor, ptitle, pbody)
		end,
		Section = function(self, title)
			return CreateSection(pageContent, title)
		end
	}
end

-- Window Factory
function KazeUI:CreateWindow(config)
	config = config or {}
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = FormatImage(config.Icon or "6031763447")
	local OpenIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")

	-- Main Window
	local Window = Create("Frame", {
		Name = "MainWindow",
		Size = UDim2.fromOffset(Theme.WindowWidth, Theme.WindowHeight),
		Position = UDim2.fromScale(0.5, 0.5),
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundColor3 = Theme.Background,
		BorderSizePixel = 0,
		ClipsDescendants = true,
		Parent = ScreenGui
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 14), Parent = Window })

	local WindowStroke = Create("UIStroke", {
		Color = Theme.Primary,
		Thickness = 2.5,
		Parent = Window
	})
	StartNeonLoop(WindowStroke)

	-- TopBar
	local TopBar = Create("Frame", {
		Name = "TopBar",
		Size = UDim2.new(1, 0, 0, 56),
		BackgroundColor3 = Color3.fromRGB(15, 15, 20),
		BorderSizePixel = 0,
		Parent = Window
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 14), Parent = TopBar })
	MakeDraggable(TopBar, Window)

	-- Avatar
	local Avatar = Create("ImageLabel", {		Name = "Avatar",
		Size = UDim2.fromOffset(36, 36),
		Position = UDim2.fromOffset(12, 10),
		BackgroundColor3 = Color3.fromRGB(30, 30, 35),
		Image = MainIcon,
		Parent = TopBar
	})
	Create("UICorner", { CornerRadius = UDim.new(1, 0), Parent = Avatar })
	Create("UIStroke", {
		Color = Theme.Secondary,
		Thickness = 1,
		Parent = Avatar
	})

	-- Titles
	Create("TextLabel", {
		Size = UDim2.new(1, -220, 0, 22),
		Position = UDim2.fromOffset(56, 8),
		BackgroundTransparency = 1,
		Text = Title,
		TextColor3 = Theme.TextPrimary,
		Font = Theme.TitleFont,
		TextSize = 16,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = TopBar
	})
	Create("TextLabel", {
		Size = UDim2.new(1, -220, 0, 18),
		Position = UDim2.fromOffset(56, 30),
		BackgroundTransparency = 1,
		Text = Author .. " | v" .. Version,
		TextColor3 = Theme.TextSecondary,
		Font = Theme.BodyFont,
		TextSize = 13,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = TopBar
	})

	-- Divider
	local TopDivider = Create("Frame", {
		Name = "TopDivider",
		Size = UDim2.new(1, 0, 0, 2),
		Position = UDim2.new(0, 0, 1, -2),
		BackgroundColor3 = Theme.Divider,
		BorderSizePixel = 0,
		ZIndex = 5,
		Parent = TopBar
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 6), Parent = TopDivider })
	local topDivStroke = Create("UIStroke", {		Color = Theme.Primary,
		Thickness = 2.5,
		ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
		Parent = TopDivider
	})
	StartNeonLoop(topDivStroke)

	-- Traffic Lights
	local function createTrafficLight(name, offsetX, color)
		local btn = Create("TextButton", {
			Name = name,
			Size = UDim2.fromOffset(18, 18),
			Position = UDim2.new(1, offsetX, 0.5, -9),
			BackgroundColor3 = color,
			BorderSizePixel = 0,
			Text = " ",
			Parent = TopBar
		})
		Create("UICorner", { CornerRadius = UDim.new(1, 0), Parent = btn })
		Create("UIStroke", {
			Color = Color3.fromRGB(0, 0, 0),
			Thickness = 1,
			Parent = btn
		})
		return btn
	end

	local BtnGreen = createTrafficLight("BtnGreen", -120, Theme.Success)
	local BtnYellow = createTrafficLight("BtnYellow", -88, Theme.Warning)
	local BtnRed = createTrafficLight("BtnRed", -56, Theme.Danger)

	-- Mini Button
	local MiniButtonSize = UDim2.fromOffset(60, 60)
	local MiniButton = Create("ImageButton", {
		Name = "MiniButton",
		Size = UDim2.fromOffset(0, 0),
		Position = UDim2.fromScale(0.1, 0.1),
		BackgroundColor3 = Theme.Background,
		BorderSizePixel = 0,
		Visible = false,
		ZIndex = 999,
		ScaleType = Enum.ScaleType.Slice,
		SliceCenter = Rect.new(4, 4, 60, 60),
		Parent = ScreenGui
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 12), Parent = MiniButton })
	local miniPadding = Create("UIPadding", { Parent = MiniButton })
	miniPadding.PaddingTop = UDim.new(0, 4)
	miniPadding.PaddingBottom = UDim.new(0, 4)
	miniPadding.PaddingLeft = UDim.new(0, 4)	miniPadding.PaddingRight = UDim.new(0, 4)

	Create("ImageLabel", {
		Size = UDim2.fromScale(1, 1),
		Position = UDim2.fromScale(0.5, 0.5),
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundTransparency = 1,
		Image = OpenIcon,
		ZIndex = 1000,
		Parent = MiniButton
	})

	local MiniStroke = Create("UIStroke", {
		Color = Theme.Primary,
		Thickness = 2.5,
		ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
		Parent = MiniButton
	})
	StartNeonLoop(MiniStroke)
	MakeDraggable(MiniButton, MiniButton)

	-- State
	local defaultWindowSize = UDim2.fromOffset(Theme.WindowWidth, Theme.WindowHeight)
	local lastNormalSize = defaultWindowSize
	local lastNormalPosition = UDim2.fromScale(0.5, 0.5)
	local lastNormalAnchor = Vector2.new(0.5, 0.5)
	local toggledMaximized = false

	-- Minimize
	local function minimizeWindow()
		Window.Visible = false
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(MiniButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), { Size = MiniButtonSize }):Play()
	end
	BtnYellow.MouseButton1Click:Connect(minimizeWindow)

	-- Maximize/Restore
	BtnGreen.MouseButton1Click:Connect(function()
		if not toggledMaximized then
			lastNormalSize = Window.Size
			lastNormalPosition = Window.Position
			lastNormalAnchor = Window.AnchorPoint
			toggledMaximized = true
			Window.AnchorPoint = Vector2.new(0.5, 0.5)
			Window.Position = UDim2.fromScale(0.5, 0.5)
			TweenService:Create(Window, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), { Size = UDim2.fromScale(0.9, 0.85) }):Play()
		else
			toggledMaximized = false
			TweenService:Create(Window, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), { Size = lastNormalSize }):Play()			task.delay(0.25, function()
				if Window.Parent then
					Window.Position = lastNormalPosition
					Window.AnchorPoint = lastNormalAnchor
				end
			end)
		end
	end)

	-- Restore from Mini
	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.fromOffset(0, 0)
		if toggledMaximized then
			Window.AnchorPoint = Vector2.new(0.5, 0.5)
			Window.Position = UDim2.fromScale(0.5, 0.5)
			TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), { Size = UDim2.fromScale(0.9, 0.85) }):Play()
		else
			Window.AnchorPoint = lastNormalAnchor
			Window.Position = lastNormalPosition
			TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), { Size = lastNormalSize }):Play()
		end
	end)

	-- Close Confirmation
	local function ShowCloseConfirm()
		local Overlay = Create("Frame", {
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundColor3 = Color3.fromRGB(0, 0, 0),
			BackgroundTransparency = 0.6,
			ZIndex = 50,
			Parent = Window
		})

		local Shadow = Create("Frame", {
			Size = UDim2.fromOffset(364, 164),
			AnchorPoint = Vector2.new(0.5, 0.5),
			Position = UDim2.fromScale(0.5, 0.5),
			BackgroundColor3 = Color3.fromRGB(0, 0, 0),
			BackgroundTransparency = 0.75,
			ZIndex = 51,
			Parent = Overlay
		})
		Create("UICorner", { CornerRadius = UDim.new(0, 14), Parent = Shadow })

		local ConfirmWindow = Create("Frame", {
			Size = UDim2.fromOffset(350, 150),
			AnchorPoint = Vector2.new(0.5, 0.5),
			Position = UDim2.fromScale(0.5, 0.5),			BackgroundColor3 = Color3.fromRGB(25, 25, 30),
			ZIndex = 52,
			Parent = Overlay
		})
		Create("UICorner", { CornerRadius = UDim.new(0, 12), Parent = ConfirmWindow })
		local confirmStroke = Create("UIStroke", {
			Color = Theme.Primary,
			Thickness = 2.5,
			ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
			Parent = ConfirmWindow
		})
		StartNeonLoop(confirmStroke)

		Create("TextLabel", {
			Size = UDim2.new(1, -32, 0, 48),
			Position = UDim2.fromOffset(16, 20),
			BackgroundTransparency = 1,
			Text = "Are you sure you want to close the UI?",
			TextColor3 = Color3.fromRGB(230, 230, 230),
			Font = Theme.TitleFont,
			TextSize = 18,
			TextWrapped = true,
			ZIndex = 53,
			Parent = ConfirmWindow
		})

		local ButtonsFrame = Create("Frame", {
			Size = UDim2.new(1, 0, 0, 40),
			Position = UDim2.new(0, 0, 1, -20),
			AnchorPoint = Vector2.new(0, 1),
			BackgroundTransparency = 1,
			ZIndex = 53,
			Parent = ConfirmWindow
		})
		Create("UIListLayout", {
			FillDirection = Enum.FillDirection.Horizontal,
			HorizontalAlignment = Enum.HorizontalAlignment.Center,
			Padding = UDim.new(0, 16),
			Parent = ButtonsFrame
		})

		local ConfirmBtn = Create("TextButton", {
			Size = UDim2.new(0, 120, 0, 36),
			BackgroundColor3 = Theme.Primary,
			Text = "Confirm",
			TextColor3 = Color3.fromRGB(230, 230, 230),
			Font = Theme.TitleFont,
			TextSize = 16,
			ZIndex = 54,
			Parent = ButtonsFrame		})
		Create("UICorner", { CornerRadius = UDim.new(0, 8), Parent = ConfirmBtn })

		local CancelBtn = Create("TextButton", {
			Size = UDim2.new(0, 120, 0, 36),
			BackgroundColor3 = Color3.fromRGB(45, 45, 50),
			Text = "Cancel",
			TextColor3 = Color3.fromRGB(220, 220, 220),
			Font = Theme.TitleFont,
			TextSize = 16,
			ZIndex = 54,
			Parent = ButtonsFrame
		})
		Create("UICorner", { CornerRadius = UDim.new(0, 8), Parent = CancelBtn })

		ConfirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
		end)
	end
	BtnRed.MouseButton1Click:Connect(ShowCloseConfirm)

	-- Content Area
	local Content = Create("Frame", {
		Position = UDim2.fromOffset(0, 56),
		Size = UDim2.new(1, 0, 1, -56),
		BackgroundTransparency = 1,
		Parent = Window
	})

	-- Sidebar
	local SideBar = Create("Frame", {
		Name = "SideBar",
		Size = UDim2.new(0, Theme.SidebarWidth, 1, 0),
		BackgroundColor3 = Theme.Background,
		BorderSizePixel = 0,
		Parent = Content
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 14), Parent = SideBar })

	-- Vertical Divider
	local VertDivider = Create("Frame", {
		Name = "VertDivider",
		Size = UDim2.new(0, 2, 1, 0),
		Position = UDim2.new(0, Theme.SidebarWidth, 0, 0),
		BackgroundColor3 = Theme.Primary,
		BorderSizePixel = 0,
		Parent = Content	})
	Create("UICorner", { CornerRadius = UDim.new(0, 6), Parent = VertDivider })
	local vertDivStroke = Create("UIStroke", {
		Color = Theme.Primary,
		Thickness = 2.5,
		ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
		Parent = VertDivider
	})
	StartNeonLoop(vertDivStroke)

	-- Pages Container
	local Pages = Create("Frame", {
		Name = "Pages",
		Position = UDim2.new(0, Theme.SidebarWidth + 2, 0, 0),
		Size = UDim2.new(1, -(Theme.SidebarWidth + 2), 1, 0),
		BackgroundColor3 = Color3.fromRGB(18, 18, 23),
		BorderSizePixel = 0,
		Parent = Content
	})
	Create("UICorner", { CornerRadius = UDim.new(0, 12), Parent = Pages })

	-- Scrollable Tabs
	local TabsScroller = Create("ScrollingFrame", {
		Name = "TabsScroller",
		Position = UDim2.fromOffset(8, 8),
		Size = UDim2.new(1, -16, 1, -16),
		BackgroundTransparency = 1,
		ScrollBarThickness = 6,
		CanvasSize = UDim2.new(0, 0, 0, 0),
		AutomaticCanvasSize = Enum.AutomaticSize.Y,
		ScrollBarImageColor3 = Color3.fromRGB(40, 40, 45),
		Parent = SideBar
	})

	local TabsList = Create("Frame", {
		Name = "TabsList",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 0),
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = TabsScroller
	})
	Create("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 8),
		Parent = TabsList
	})

	-- Window Object
	local Win = {
		Window = Window,		Content = Content,
		Icon = Avatar,
		MiniButton = MiniButton,
		SideBar = SideBar,
		_Pages = Pages,
		_TabsList = TabsList,
		_Tabs = {},
		_Stroke = Theme.Primary
	}

	function Win:CreateTab(name, iconId)
		local tab = CreateTab(self._TabsList, name, iconId, self._Pages, self._Stroke)
		table.insert(self._Tabs, tab)
		if #self._Tabs == 1 then
			tab:Activate()
		end
		return tab
	end

	function Win:GetTabs()
		local out = {}
		for i, t in ipairs(self._Tabs) do
			table.insert(out, { Index = i, Button = t.Button, Page = t.Page })
		end
		return out
	end

	if typeof(config.Callback) == "function" then
		task.spawn(config.Callback)
	end

	return Win
end

return KazeUI
