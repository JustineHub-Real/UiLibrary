-- Kaze UI Base (extended)
-- Added: Tab:Section, Tab:AddLabel, Tab:CreateParagraph, Tab:CreateButton
-- Section titles default to blue text. Section/Add helpers add content into the last created section.

local KazeUI = {}
KazeUI.__index = KazeUI

--// Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

--// Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KazeUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LP:WaitForChild("PlayerGui")

--// UIScale for consistent scaling across devices
local UIScale = Instance.new("UIScale")
UIScale.Parent = ScreenGui

local function UpdateScale()
	local size = workspace.CurrentCamera.ViewportSize
	if size.X < 600 then
		UIScale.Scale = math.clamp(size.X / 800, 0.5, 1)
	else
		UIScale.Scale = math.clamp(size.X / 1920, 0.6, 1)
	end
end
UpdateScale()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(UpdateScale)

--// Texture ID Sanitizer
local function FormatImage(id)
	if not id then return "" end
	id = tostring(id)
	local clean = string.gsub(id, "%D", "") -- keep only digits
	if clean == "" then return "" end
	return "rbxassetid://" .. clean
end

--// Drag Function (works with Mouse and Touch)
local function MakeDraggable(dragPart, targetPart)
	local dragging = false
	local dragInput, dragStart, startPos

	local function update(input)
		if not dragStart or not startPos then return end
		local delta = input.Position - dragStart
		targetPart.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	dragPart.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = targetPart.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					dragInput = nil
				end
			end)
		end
	end)

	dragPart.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

-- helper for neon tween loops
local function StartNeonLoop(targetStroke)
	spawn(function()
		while targetStroke and targetStroke.Parent do
			local t = TweenService:Create(targetStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Color = Color3.fromRGB(0, 255, 255)})
			t:Play()
			break
		end
	end)
end

--// CREATE WINDOW
function KazeUI:CreateWindow(config)
	config = config or {}

	-- Main Config
	local Title = config.Title or "Kaze UI"
	local Author = config.Author or "Unknown"
	local Version = config.Version or "1.0"
	local MainIcon = FormatImage(config.Icon or "6031763447")

	-- Open Button Config (ENFORCED to 60x60 for mobile playability)
	local OpenIcon = FormatImage((config.OpenButton and config.OpenButton.Icon) or config.Icon or "6031763447")
	local MiniButtonSize = UDim2.fromOffset(60, 60)
	local Callback = config.Callback

	--// Main Window
	local Window = Instance.new("Frame")
	Window.Name = "MainWindow"
	Window.Size = UDim2.fromOffset(650, 420)
	Window.Position = UDim2.fromScale(0.5, 0.5)
	Window.AnchorPoint = Vector2.new(0.5, 0.5)
	Window.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	Window.BorderSizePixel = 0
	Window.Parent = ScreenGui
	Window.ClipsDescendants = true
	Instance.new("UICorner", Window).CornerRadius = UDim.new(0, 14)

	local WindowStroke = Instance.new("UIStroke")
	WindowStroke.Color = Color3.fromRGB(0, 160, 255)
	WindowStroke.Thickness = 2.5 -- neon thickness (used as reference)
	WindowStroke.Parent = Window
	StartNeonLoop(WindowStroke)

	--// Top Bar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 56)
	TopBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	TopBar.BorderSizePixel = 0
	TopBar.Parent = Window
	Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0, 14)
	MakeDraggable(TopBar, Window)

	-- Avatar
	local Avatar = Instance.new("ImageLabel")
	Avatar.Name = "Avatar"
	Avatar.Size = UDim2.fromOffset(36, 36)
	Avatar.Position = UDim2.fromOffset(12, 10)
	Avatar.BackgroundTransparency = 0
	Avatar.BackgroundColor3 = Color3.fromRGB(30,30,35)
	Avatar.Image = MainIcon
	Avatar.Parent = TopBar
	Instance.new("UICorner", Avatar).CornerRadius = UDim.new(1, 0)
	local avatarStroke = Instance.new("UIStroke", Avatar)
	avatarStroke.Color = Color3.fromRGB(0, 140, 200)
	avatarStroke.Thickness = 1

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, -220, 0, 22)
	TitleLabel.Position = UDim2.fromOffset(56, 8)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = Title
	TitleLabel.TextColor3 = Color3.fromRGB(235, 235, 235)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextSize = 16
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	TitleLabel.Parent = TopBar

	local SubLabel = Instance.new("TextLabel")
	SubLabel.Size = UDim2.new(1, -220, 0, 18)
	SubLabel.Position = UDim2.fromOffset(56, 30)
	SubLabel.BackgroundTransparency = 1
	SubLabel.Text = Author .. " | v" .. Version
	SubLabel.TextColor3 = Color3.fromRGB(160, 160, 160)
	SubLabel.Font = Enum.Font.Gotham
	SubLabel.TextSize = 13
	SubLabel.TextXAlignment = Enum.TextXAlignment.Left
	SubLabel.Parent = TopBar

	-- TopBar bottom cyan divider (thin) using stroke so it matches outline thickness visually
	local TopDivider = Instance.new("Frame")
	TopDivider.Name = "TopDivider"
	TopDivider.Size = UDim2.new(1, 0, 0, 2)
	TopDivider.Position = UDim2.new(0, 0, 1, -2)
	TopDivider.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
	TopDivider.BorderSizePixel = 0
	TopDivider.ZIndex = 5
	TopDivider.Parent = TopBar
	Instance.new("UICorner", TopDivider).CornerRadius = UDim.new(0, 6)

	local topDivStroke = Instance.new("UIStroke")
	topDivStroke.Parent = TopDivider
	topDivStroke.Color = WindowStroke.Color
	topDivStroke.Thickness = WindowStroke.Thickness -- match outline thickness
	topDivStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	StartNeonLoop(topDivStroke)

	--// Traffic-light buttons
	local defaultWindowSize = UDim2.fromOffset(650, 420)
	local lastNormalSize = defaultWindowSize
	local lastNormalPosition = UDim2.fromScale(0.5, 0.5)
	local lastNormalAnchor = Vector2.new(0.5, 0.5)
	local toggledMaximized = false

	local function createCircleButton(name, offsetX, color)
		local btn = Instance.new("TextButton")
		btn.Name = name
		btn.Size = UDim2.fromOffset(18, 18)
		btn.Position = UDim2.new(1, offsetX, 0.5, -9)
		btn.BackgroundColor3 = color
		btn.BorderSizePixel = 0
		btn.Text = ""
		btn.Parent = TopBar
		Instance.new("UICorner", btn).CornerRadius = UDim.new(1, 0)
		local stroke = Instance.new("UIStroke", btn)
		stroke.Color = Color3.fromRGB(0, 0, 0)
		stroke.Thickness = 1
		return btn
	end

	local BtnGreen = createCircleButton("BtnGreen", -120, Color3.fromRGB(117, 204, 50))
	local BtnYellow = createCircleButton("BtnYellow", -88, Color3.fromRGB(255, 204, 51))
	local BtnRed = createCircleButton("BtnRed", -56, Color3.fromRGB(235, 80, 80))

	-- Minimize behavior (yellow) + MiniButton
	local MiniButton = Instance.new("ImageButton")
	MiniButton.Name = "MiniButton"
	MiniButton.Size = MiniButtonSize
	MiniButton.Position = UDim2.fromScale(0.1, 0.1)
	MiniButton.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	MiniButton.BorderSizePixel = 0
	MiniButton.Visible = false
	MiniButton.Parent = ScreenGui
	MiniButton.ZIndex = 999
	MiniButton.ScaleType = Enum.ScaleType.Slice
	MiniButton.SliceCenter = Rect.new(4,4,60,60)
	Instance.new("UICorner", MiniButton).CornerRadius = UDim.new(0, 12)

	local miniPadding = Instance.new("UIPadding")
	miniPadding.PaddingTop = UDim.new(0, 4)
	miniPadding.PaddingBottom = UDim.new(0, 4)
	miniPadding.PaddingLeft = UDim.new(0, 4)
	miniPadding.PaddingRight = UDim.new(0, 4)
	miniPadding.Parent = MiniButton

	local MiniIcon = Instance.new("ImageLabel")
	MiniIcon.Size = UDim2.fromScale(1, 1)
	MiniIcon.Position = UDim2.fromScale(0.5, 0.5)
	MiniIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	MiniIcon.BackgroundTransparency = 1
	MiniIcon.Image = OpenIcon
	MiniIcon.Parent = MiniButton
	MiniIcon.ZIndex = 1000

	local MiniStroke = Instance.new("UIStroke")
	MiniStroke.Color = WindowStroke.Color
	MiniStroke.Thickness = WindowStroke.Thickness
	MiniStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	MiniStroke.Parent = MiniButton
	StartNeonLoop(MiniStroke)

	MakeDraggable(TopBar, Window)
	MakeDraggable(MiniButton, MiniButton)

	local function minimizeWindow()
		Window.Visible = false
		MiniButton.Visible = true
		MiniButton.Size = UDim2.fromOffset(0, 0)
		TweenService:Create(MiniButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = MiniButtonSize}):Play()
	end

	BtnYellow.MouseButton1Click:Connect(minimizeWindow)

	-- Green toggle maximize/restore (store previous)
	BtnGreen.MouseButton1Click:Connect(function()
		if not toggledMaximized then
			lastNormalSize = Window.Size
			lastNormalPosition = Window.Position
			lastNormalAnchor = Window.AnchorPoint

			toggledMaximized = true
			Window.AnchorPoint = Vector2.new(0.5, 0.5)
			Window.Position = UDim2.fromScale(0.5, 0.5)
			TweenService:Create(Window, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.fromScale(0.9, 0.85)}):Play()
		else
			toggledMaximized = false
			local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
			TweenService:Create(Window, tweenInfo, {Size = lastNormalSize, Position = lastNormalPosition}):Play()
			delay(0.25, function()
				Window.AnchorPoint = lastNormalAnchor
			end)
		end
	end)

	-- restore from MiniButton respecting maximized flag
	MiniButton.MouseButton1Click:Connect(function()
		MiniButton.Visible = false
		Window.Visible = true
		Window.Size = UDim2.fromOffset(0, 0)
		if toggledMaximized then
			Window.AnchorPoint = Vector2.new(0.5, 0.5)
			Window.Position = UDim2.fromScale(0.5, 0.5)
			TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.fromScale(0.9, 0.85)}):Play()
		else
			Window.AnchorPoint = lastNormalAnchor
			Window.Position = lastNormalPosition
			TweenService:Create(Window, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = lastNormalSize, Position = lastNormalPosition}):Play()
		end
	end)

	-- Close confirm (red) â€” improved rounded shadow + matching neon outline on dialog
	local function ShowCloseConfirm()
		BtnYellow.Active = false
		BtnGreen.Active = false
		BtnRed.Active = false
		local Overlay = Instance.new("Frame")
		Overlay.Size = UDim2.new(1, 0, 1, 0)
		Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		Overlay.BackgroundTransparency = 0.6
		Overlay.ZIndex = 50
		Overlay.Parent = Window

		-- Shadow behind confirm window (slightly larger, rounded)
		local Shadow = Instance.new("Frame")
		Shadow.Size = UDim2.fromOffset(364, 164) -- slightly larger so rounded shadow visible
		Shadow.AnchorPoint = Vector2.new(0.5, 0.5)
		Shadow.Position = UDim2.fromScale(0.5, 0.5)
		Shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		Shadow.BackgroundTransparency = 0.75
		Shadow.ZIndex = 51
		Shadow.Parent = Overlay
		local shadowCorner = Instance.new("UICorner", Shadow)
		shadowCorner.CornerRadius = UDim.new(0, 14) -- match dialog rounding

		local ConfirmWindow = Instance.new("Frame")
		ConfirmWindow.Size = UDim2.fromOffset(350, 150)
		ConfirmWindow.AnchorPoint = Vector2.new(0.5, 0.5)
		ConfirmWindow.Position = UDim2.fromScale(0.5, 0.5)
		ConfirmWindow.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
		ConfirmWindow.ZIndex = 52
		ConfirmWindow.Parent = Overlay
		Instance.new("UICorner", ConfirmWindow).CornerRadius = UDim.new(0, 12)

		-- neon outline for confirm window (matching WindowStroke)
		local confirmStroke = Instance.new("UIStroke", ConfirmWindow)
		confirmStroke.Color = WindowStroke.Color
		confirmStroke.Thickness = 2.5
		confirmStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
		StartNeonLoop(confirmStroke)

		local ConfirmText = Instance.new("TextLabel")
		ConfirmText.Size = UDim2.new(1, -32, 0, 48)
		ConfirmText.Position = UDim2.fromOffset(16, 20)
		ConfirmText.BackgroundTransparency = 1
		ConfirmText.Text = "Are you sure you want to close the UI?"
		ConfirmText.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmText.Font = Enum.Font.GothamBold
		ConfirmText.TextSize = 18
		ConfirmText.TextWrapped = true
		ConfirmText.ZIndex = 53
		ConfirmText.Parent = ConfirmWindow

		local ButtonsFrame = Instance.new("Frame")
		ButtonsFrame.Size = UDim2.new(1, 0, 0, 40)
		ButtonsFrame.Position = UDim2.new(0, 0, 1, -20)
		ButtonsFrame.AnchorPoint = Vector2.new(0, 1)
		ButtonsFrame.BackgroundTransparency = 1
		ButtonsFrame.ZIndex = 53
		ButtonsFrame.Parent = ConfirmWindow

		local layout = Instance.new("UIListLayout")
		layout.Parent = ButtonsFrame
		layout.FillDirection = Enum.FillDirection.Horizontal
		layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		layout.Padding = UDim.new(0, 16)

		local ConfirmBtn = Instance.new("TextButton")
		ConfirmBtn.Size = UDim2.new(0, 120, 0, 36)
		ConfirmBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
		ConfirmBtn.Text = "Confirm"
		ConfirmBtn.TextColor3 = Color3.fromRGB(230, 230, 230)
		ConfirmBtn.Font = Enum.Font.GothamBold
		ConfirmBtn.TextSize = 16
		ConfirmBtn.ZIndex = 54
		ConfirmBtn.Parent = ButtonsFrame
		Instance.new("UICorner", ConfirmBtn).CornerRadius = UDim.new(0, 8)

		local CancelBtn = Instance.new("TextButton")
		CancelBtn.Size = UDim2.new(0, 120, 0, 36)
		CancelBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
		CancelBtn.Text = "Cancel"
		CancelBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
		CancelBtn.Font = Enum.Font.GothamBold
		CancelBtn.TextSize = 16
		CancelBtn.ZIndex = 54
		CancelBtn.Parent = ButtonsFrame
		Instance.new("UICorner", CancelBtn).CornerRadius = UDim.new(0, 8)

		ConfirmBtn.MouseButton1Click:Connect(function()
			ScreenGui:Destroy()
		end)
		CancelBtn.MouseButton1Click:Connect(function()
			Overlay:Destroy()
			BtnYellow.Active = true
			BtnGreen.Active = true
			BtnRed.Active = true
		end)
	end
	BtnRed.MouseButton1Click:Connect(ShowCloseConfirm)

	-- Content + left sidebar + vertical cyan divider (thin, stroke-matched)
	local Content = Instance.new("Frame")
	Content.Position = UDim2.fromOffset(0, 56)
	Content.Size = UDim2.new(1, 0, 1, -56)
	Content.BackgroundTransparency = 1
	Content.Parent = Window

	-- SideBar (will contain a ScrollingFrame for tabs)
	local SideBar = Instance.new("Frame")
	SideBar.Name = "SideBar"
	SideBar.Size = UDim2.new(0, 180, 1, 0)
	SideBar.Position = UDim2.new(0, 0, 0, 0)
	SideBar.BackgroundColor3 = Color3.fromRGB(20,20,25)
	SideBar.BorderSizePixel = 0
	SideBar.Parent = Content
	Instance.new("UICorner", SideBar).CornerRadius = UDim.new(0, 14)

	-- thin divider using stroke to match outline thickness
	local VertDivider = Instance.new("Frame")
	VertDivider.Name = "VertDivider"
	VertDivider.Size = UDim2.new(0, 2, 1, 0) -- thin filled bar; stroke will give neon thickness
	VertDivider.Position = UDim2.new(0, 180, 0, 0)
	VertDivider.BackgroundColor3 = WindowStroke.Color
	VertDivider.BorderSizePixel = 0
	VertDivider.Parent = Content
	Instance.new("UICorner", VertDivider).CornerRadius = UDim.new(0, 6)

	local vertDivStroke = Instance.new("UIStroke")
	vertDivStroke.Parent = VertDivider
	vertDivStroke.Color = WindowStroke.Color
	vertDivStroke.Thickness = WindowStroke.Thickness -- match outline thickness
	vertDivStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	StartNeonLoop(vertDivStroke)

	-- Right content area (pages)
	local Pages = Instance.new("Frame")
	Pages.Name = "Pages"
	Pages.Position = UDim2.new(0, 182, 0, 0)
	Pages.Size = UDim2.new(1, -182, 1, 0)
	Pages.BackgroundColor3 = Color3.fromRGB(18, 18, 23)
	Pages.BorderSizePixel = 0
	Pages.Parent = Content
	Instance.new("UICorner", Pages).CornerRadius = UDim.new(0, 12)

	-- Tabs list (scrolling) inside the sidebar
	local TabsList = Instance.new("ScrollingFrame")
	TabsList.Name = "TabsList"
	TabsList.Parent = SideBar
	TabsList.Position = UDim2.fromOffset(8, 8)
	TabsList.Size = UDim2.new(1, -16, 1, -16)
	TabsList.BackgroundTransparency = 1
	TabsList.BorderSizePixel = 0
	TabsList.CanvasSize = UDim2.new(0, 0, 0, 0)
	TabsList.ScrollBarThickness = 6
	TabsList.VerticalScrollBarInset = Enum.ScrollBarInset.Always
	TabsList.AutomaticCanvasSize = Enum.AutomaticSize.Y

	local tabsLayout = Instance.new("UIListLayout")
	tabsLayout.Parent = TabsList
	tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabsLayout.Padding = UDim.new(0, 8)

	-- container to hold tab data
	local createdTabs = {}

	-- small constants for tab appearance (easy to tweak)
	local TAB_BUTTON_HEIGHT = 44
	local TAB_CORNER_RADIUS = 6
	local TAB_BG = Color3.fromRGB(24,24,28)
	local TAB_BG_ACTIVE = Color3.fromRGB(32,32,36)
	local TAB_TEXT_COLOR = Color3.fromRGB(240,240,240)
	local TAB_TEXT_INACTIVE = Color3.fromRGB(200,200,200)

	-- returned wrapper object (so caller can call :CreateTab)
	local Win = {
		Window = Window,
		Content = Content,
		Icon = Avatar,
		MiniButton = MiniButton,
		SideBar = SideBar,
		_Pages = Pages, -- internal
		_TabsList = TabsList,
		_Tabs = createdTabs,
		_Stroke = WindowStroke,
	}

	-- CreateTab API: name (string), iconId (number/string) optional
	function Win:CreateTab(name, iconId)
		name = tostring(name or "Tab")
		local formattedIcon = FormatImage(iconId or "")

		-- Button
		local btn = Instance.new("TextButton")
		btn.Name = "TabButton_" .. name
		btn.Size = UDim2.new(1, -16, 0, TAB_BUTTON_HEIGHT)
		btn.BackgroundColor3 = TAB_BG
		btn.BorderSizePixel = 0
		btn.Text = ""
		btn.AutoButtonColor = false
		btn.Parent = TabsList
		Instance.new("UICorner", btn).CornerRadius = UDim.new(0, TAB_CORNER_RADIUS)

		-- left indicator (cyan thin bar)
		local leftIndicator = Instance.new("Frame")
		leftIndicator.Name = "LeftIndicator"
		leftIndicator.Size = UDim2.new(0, 4, 1, 0)
		leftIndicator.Position = UDim2.new(0, 0, 0, 0)
		leftIndicator.BackgroundColor3 = self._Stroke.Color
		leftIndicator.BorderSizePixel = 0
		leftIndicator.Visible = false
		leftIndicator.Parent = btn
		Instance.new("UICorner", leftIndicator).CornerRadius = UDim.new(0, 6)

		-- Icon
		local iconLabel = Instance.new("ImageLabel")
		iconLabel.Name = "Icon"
		iconLabel.Size = UDim2.fromOffset(28, 28)
		iconLabel.Position = UDim2.new(0, 10, 0.5, -14)
		iconLabel.BackgroundTransparency = 1
		iconLabel.Image = formattedIcon
		iconLabel.Parent = btn
		Instance.new("UICorner", iconLabel).CornerRadius = UDim.new(1, 0)

		-- Text
		local txt = Instance.new("TextLabel")
		txt.Name = "Label"
		txt.Size = UDim2.new(1, -56, 1, 0)
		txt.Position = UDim2.fromOffset(48, 0)
		txt.BackgroundTransparency = 1
		txt.Text = name
		txt.TextColor3 = TAB_TEXT_INACTIVE
		txt.Font = Enum.Font.Gotham
		txt.TextSize = 15
		txt.TextXAlignment = Enum.TextXAlignment.Left
		txt.Parent = btn

		-- Page (content) created for the tab
		local page = Instance.new("Frame")
		page.Name = "Page_" .. name
		page.Size = UDim2.new(1, 0, 1, 0)
		page.Position = UDim2.new(0, 0, 0, 0)
		page.BackgroundTransparency = 1
		page.BorderSizePixel = 0
		page.Parent = self._Pages
		page.Visible = false
		Instance.new("UICorner", page).CornerRadius = UDim.new(0, 6)

		-- PageContainer (scrolling) that holds sections and content for the page
		local pageContainer = Instance.new("ScrollingFrame")
		pageContainer.Name = "PageContainer"
		pageContainer.Size = UDim2.new(1, -24, 1, -24)
		pageContainer.Position = UDim2.fromOffset(12, 12)
		pageContainer.BackgroundTransparency = 1
		pageContainer.BorderSizePixel = 0
		pageContainer.Parent = page
		pageContainer.ScrollBarThickness = 8
		pageContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
		pageContainer.VerticalScrollBarInset = Enum.ScrollBarInset.Always

		local pageLayout = Instance.new("UIListLayout")
		pageLayout.Parent = pageContainer
		pageLayout.SortOrder = Enum.SortOrder.LayoutOrder
		pageLayout.Padding = UDim.new(0, 12)

		-- store tab
		local tabObj = {
			Button = btn,
			Indicator = leftIndicator,
			Label = txt,
			Icon = iconLabel,
			Page = page,
			PageContainer = pageContainer, -- where content is added
		}
		table.insert(self._Tabs, tabObj)

		-- activation function
		local function activate()
			for _, t in ipairs(self._Tabs) do
				if t.Button and t.Indicator and t.Page and t.Label then
					-- reset visuals
					TweenService:Create(t.Button, TweenInfo.new(0.12), {BackgroundColor3 = TAB_BG}):Play()
					t.Indicator.Visible = false
					t.Page.Visible = false
					t.Label.TextColor3 = TAB_TEXT_INACTIVE
					t.Label.Font = Enum.Font.Gotham
				end
			end
			-- set selected look
			TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = TAB_BG_ACTIVE}):Play()
			leftIndicator.Visible = true
			page.Visible = true
			txt.TextColor3 = TAB_TEXT_COLOR
			txt.Font = Enum.Font.GothamBold
			-- ensure page is on top of other pages
			page.Parent = self._Pages
		end

		-- hover animations (lightweight)
		local hoverTweenInfo = TweenInfo.new(0.10, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local hoverBG = Color3.fromRGB(28,28,31)
		local leaveBG = TAB_BG
		btn.MouseEnter:Connect(function()
			if not leftIndicator.Visible then
				TweenService:Create(btn, hoverTweenInfo, {BackgroundColor3 = hoverBG}):Play()
				txt.TextColor3 = Color3.fromRGB(220,220,220)
			end
		end)
		btn.MouseLeave:Connect(function()
			if not leftIndicator.Visible then
				TweenService:Create(btn, hoverTweenInfo, {BackgroundColor3 = leaveBG}):Play()
				txt.TextColor3 = TAB_TEXT_INACTIVE
			end
		end)

		-- click to activate
		btn.MouseButton1Click:Connect(activate)

		-- auto-activate first tab
		if #self._Tabs == 1 then
			activate()
		end

		-- public API for the tab
		local public = {
			Button = btn,
			Page = page,
			PageContainer = pageContainer,
			Activate = activate,
			SetIcon = function(newIcon)
				iconLabel.Image = FormatImage(newIcon)
			end,
			SetText = function(newText)
				txt.Text = tostring(newText or "")
			end,
			_LastSection = nil, -- internal: last created section container
		}

		-- Helper: ensure we have a section to add content into; if none exists create a default one
		local function ensureSection()
			if public._LastSection and public._LastSection.Parent and public._LastSection.ContentLayout then
				return public._LastSection
			end
			-- create default unnamed section
			return public:Section(" ")
		end

		-- Section API on the tab (creates a dedicated container in the page for grouped content)
		function public:Section(title)
			title = tostring(title or "")

			local sectionFrame = Instance.new("Frame")
			sectionFrame.Name = "Section_" .. title
			sectionFrame.Size = UDim2.new(1, 0, 0, 8) -- height will auto-size via children + UIListLayout (start small)
			sectionFrame.BackgroundTransparency = 1
			sectionFrame.BorderSizePixel = 0
			sectionFrame.Parent = public.PageContainer

			-- container to auto-fit children vertically
			local contentHolder = Instance.new("Frame")
			contentHolder.Name = "ContentHolder"
			contentHolder.Size = UDim2.new(1, 0, 0, 0)
			contentHolder.BackgroundTransparency = 1
			contentHolder.BorderSizePixel = 0
			contentHolder.Parent = sectionFrame

			local contentLayout = Instance.new("UIListLayout")
			contentLayout.Parent = contentHolder
			contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
			contentLayout.Padding = UDim.new(0, 8)

			-- Title label centered
			local titleLabel = Instance.new("TextLabel")
			titleLabel.Name = "SectionTitle"
			titleLabel.Size = UDim2.new(1, 0, 0, 28)
			titleLabel.BackgroundTransparency = 1
			titleLabel.Text = title
			titleLabel.TextColor3 = Color3.fromRGB(0, 120, 255) -- blue text as requested
			titleLabel.Font = Enum.Font.GothamBold
			titleLabel.TextSize = 22
			titleLabel.TextWrapped = true
			titleLabel.TextXAlignment = Enum.TextXAlignment.Center
			titleLabel.Parent = contentHolder

			-- optional separator
			local sep = Instance.new("Frame")
			sep.Name = "SectionSeparator"
			sep.Size = UDim2.new(1, -40, 0, 2)
			sep.BackgroundColor3 = Color3.fromRGB(38,38,42)
			sep.BorderSizePixel = 0
			sep.Parent = contentHolder
			Instance.new("UICorner", sep).CornerRadius = UDim.new(0, 4)

			-- auto-size the section frame height based on contentHolder size
			contentHolder:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
				local absY = contentHolder.AbsoluteSize.Y
				sectionFrame.Size = UDim2.new(1, 0, 0, absY)
			end)

			public._LastSection = {
				Frame = sectionFrame,
				ContentHolder = contentHolder,
				ContentLayout = contentLayout,
				TitleLabel = titleLabel
			}

			-- section-local helpers
			local sectionPublic = {}

			function sectionPublic:AddLabel(text)
				local label = Instance.new("TextLabel")
				label.Size = UDim2.new(1, -20, 0, 20)
				label.BackgroundTransparency = 1
				label.Text = tostring(text or "")
				label.TextColor3 = Color3.fromRGB(220,220,220)
				label.Font = Enum.Font.Gotham
				label.TextSize = 14
				label.TextXAlignment = Enum.TextXAlignment.Left
				label.Parent = contentHolder
				return label
			end

			function sectionPublic:CreateParagraph(opts)
				opts = opts or {}
				if type(opts) == "string" then
					opts = { Title = "", Text = tostring(opts) }
				end
				local titleTxt = tostring(opts.Title or "")
				local bodyTxt = tostring(opts.Text or "")

				local frame = Instance.new("Frame")
				frame.Size = UDim2.new(1, -8, 0, 0)
				frame.BackgroundTransparency = 1
				frame.BorderSizePixel = 0
				frame.Parent = contentHolder

				local titleLabel = Instance.new("TextLabel")
				titleLabel.Size = UDim2.new(1, 0, 0, 20)
				titleLabel.BackgroundTransparency = 1
				titleLabel.Text = titleTxt
				titleLabel.TextColor3 = Color3.fromRGB(240,240,240)
				titleLabel.Font = Enum.Font.GothamBold
				titleLabel.TextSize = 16
				titleLabel.TextXAlignment = Enum.TextXAlignment.Left
				titleLabel.Parent = frame

				local bodyLabel = Instance.new("TextLabel")
				bodyLabel.Size = UDim2.new(1, 0, 0, 0)
				bodyLabel.BackgroundTransparency = 1
				bodyLabel.Text = bodyTxt
				bodyLabel.TextColor3 = Color3.fromRGB(200,200,200)
				bodyLabel.Font = Enum.Font.Gotham
				bodyLabel.TextSize = 14
				bodyLabel.TextWrapped = true
				bodyLabel.TextXAlignment = Enum.TextXAlignment.Left
				bodyLabel.AutomaticSize = Enum.AutomaticSize.Y
				bodyLabel.Parent = frame

				-- auto resize frame height based on contents
				local function updateHeight()
					local total = 0
					for _, c in ipairs(frame:GetChildren()) do
						if c:IsA("TextLabel") then
							total = total + c.AbsoluteSize.Y
						end
					end
					frame.Size = UDim2.new(1, -8, 0, total + 8)
				end
				frame:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateHeight)
				titleLabel:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateHeight)
				bodyLabel:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateHeight)

				return frame
			end

			function sectionPublic:CreateButton(opts)
				opts = opts or {}
				if type(opts) == "string" then
					opts = { Title = opts, Desc = "" }
				end
				local titleTxt = tostring(opts.Title or "Button")
				local descTxt = tostring(opts.Desc or "")
				local callback = opts.Callback

				local btnFrame = Instance.new("Frame")
				btnFrame.Size = UDim2.new(1, 0, 0, 52)
				btnFrame.BackgroundTransparency = 1
				btnFrame.Parent = contentHolder

				local btn = Instance.new("TextButton")
				btn.Size = UDim2.new(1, -8, 1, 0)
				btn.Position = UDim2.fromOffset(4, 0)
				btn.BackgroundColor3 = Color3.fromRGB(40,40,44)
				btn.Text = ""
				btn.BorderSizePixel = 0
				btn.Parent = btnFrame
				Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

				local titleLabel = Instance.new("TextLabel")
				titleLabel.Size = UDim2.new(1, -12, 0, 20)
				titleLabel.Position = UDim2.fromOffset(8, 6)
				titleLabel.BackgroundTransparency = 1
				titleLabel.Text = titleTxt
				titleLabel.TextColor3 = Color3.fromRGB(235,235,235)
				titleLabel.Font = Enum.Font.GothamBold
				titleLabel.TextSize = 15
				titleLabel.TextXAlignment = Enum.TextXAlignment.Left
				titleLabel.Parent = btn

				local descLabel = Instance.new("TextLabel")
				descLabel.Size = UDim2.new(1, -12, 0, 16)
				descLabel.Position = UDim2.fromOffset(8, 26)
				descLabel.BackgroundTransparency = 1
				descLabel.Text = descTxt
				descLabel.TextColor3 = Color3.fromRGB(185,185,185)
				descLabel.Font = Enum.Font.Gotham
				descLabel.TextSize = 12
				descLabel.TextXAlignment = Enum.TextXAlignment.Left
				descLabel.Parent = btn

				-- simple click connection convenience
				if type(callback) == "function" then
					btn.MouseButton1Click:Connect(function()
						pcall(callback)
					end)
				end

				-- hover effect
				btn.MouseEnter:Connect(function()
					TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Color3.fromRGB(48,48,52)}):Play()
				end)
				btn.MouseLeave:Connect(function()
					TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Color3.fromRGB(40,40,44)}):Play()
				end)

				return btn
			end

			return sectionPublic
		end

		-- AddLabel on the TAB: adds a simple label into the last section or create a default section automatically
		function public:AddLabel(text)
			local sec = ensureSection()
			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, -20, 0, 20)
			label.BackgroundTransparency = 1
			label.Text = tostring(text or "")
			label.TextColor3 = Color3.fromRGB(220,220,220)
			label.Font = Enum.Font.Gotham
			label.TextSize = 14
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = sec.ContentHolder
			return label
		end

		-- CreateParagraph on the TAB: convenience that adds paragraph into last section
		-- Accepts either a table {Title=..., Text=...} or two args (title, text)
		function public:CreateParagraph(optsOrTitle, maybeText)
			local sec = ensureSection()
			local opts = {}
			if type(optsOrTitle) == "table" then
				opts = optsOrTitle
			else
				opts.Title = tostring(optsOrTitle or "")
				opts.Text = tostring(maybeText or "")
			end
			-- use the section-local CreateParagraph
			local sectionPublic = {}
			sectionPublic.CreateParagraph = function() end -- placeholder to satisfy linter-like checks
			-- find the sectionPublic by constructing minimal API using the sec object
			local sectionAPI = {
				ContentHolder = sec.ContentHolder
			}
			-- create paragraph similarly to sectionPublic:CreateParagraph
			local titleTxt = tostring(opts.Title or "")
			local bodyTxt = tostring(opts.Text or "")

			local frame = Instance.new("Frame")
			frame.Size = UDim2.new(1, -8, 0, 0)
			frame.BackgroundTransparency = 1
			frame.BorderSizePixel = 0
			frame.Parent = sec.ContentHolder

			local titleLabel = Instance.new("TextLabel")
			titleLabel.Size = UDim2.new(1, 0, 0, 20)
			titleLabel.BackgroundTransparency = 1
			titleLabel.Text = titleTxt
			titleLabel.TextColor3 = Color3.fromRGB(240,240,240)
			titleLabel.Font = Enum.Font.GothamBold
			titleLabel.TextSize = 16
			titleLabel.TextXAlignment = Enum.TextXAlignment.Left
			titleLabel.Parent = frame

			local bodyLabel = Instance.new("TextLabel")
			bodyLabel.Size = UDim2.new(1, 0, 0, 0)
			bodyLabel.BackgroundTransparency = 1
			bodyLabel.Text = bodyTxt
			bodyLabel.TextColor3 = Color3.fromRGB(200,200,200)
			bodyLabel.Font = Enum.Font.Gotham
			bodyLabel.TextSize = 14
			bodyLabel.TextWrapped = true
			bodyLabel.TextXAlignment = Enum.TextXAlignment.Left
			bodyLabel.AutomaticSize = Enum.AutomaticSize.Y
			bodyLabel.Parent = frame

			-- auto resize frame height based on contents
			local function updateHeight()
				local total = 0
				for _, c in ipairs(frame:GetChildren()) do
					if c:IsA("TextLabel") then
						total = total + c.AbsoluteSize.Y
					end
				end
				frame.Size = UDim2.new(1, -8, 0, total + 8)
			end
			frame:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateHeight)
			titleLabel:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateHeight)
			bodyLabel:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateHeight)

			return frame
		end

		-- CreateButton on the TAB: convenience that adds a button into the last section
		-- Accepts table {Title=..., Desc=..., Callback=function() end} or (title, desc, callback)
		function public:CreateButton(optsOrTitle, maybeDesc, maybeCallback)
			local sec = ensureSection()
			local opts = {}
			if type(optsOrTitle) == "table" then
				opts = optsOrTitle
			else
				opts.Title = tostring(optsOrTitle or "Button")
				opts.Desc = tostring(maybeDesc or "")
				opts.Callback = maybeCallback
			end

			-- create button frame
			local btnFrame = Instance.new("Frame")
			btnFrame.Size = UDim2.new(1, 0, 0, 52)
			btnFrame.BackgroundTransparency = 1
			btnFrame.Parent = sec.ContentHolder

			local btn = Instance.new("TextButton")
			btn.Size = UDim2.new(1, -8, 1, 0)
			btn.Position = UDim2.fromOffset(4, 0)
			btn.BackgroundColor3 = Color3.fromRGB(40,40,44)
			btn.Text = ""
			btn.BorderSizePixel = 0
			btn.Parent = btnFrame
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)

			local titleLabel = Instance.new("TextLabel")
			titleLabel.Size = UDim2.new(1, -12, 0, 20)
			titleLabel.Position = UDim2.fromOffset(8, 6)
			titleLabel.BackgroundTransparency = 1
			titleLabel.Text = tostring(opts.Title or "Button")
			titleLabel.TextColor3 = Color3.fromRGB(235,235,235)
			titleLabel.Font = Enum.Font.GothamBold
			titleLabel.TextSize = 15
			titleLabel.TextXAlignment = Enum.TextXAlignment.Left
			titleLabel.Parent = btn

			local descLabel = Instance.new("TextLabel")
			descLabel.Size = UDim2.new(1, -12, 0, 16)
			descLabel.Position = UDim2.fromOffset(8, 26)
			descLabel.BackgroundTransparency = 1
			descLabel.Text = tostring(opts.Desc or "")
			descLabel.TextColor3 = Color3.fromRGB(185,185,185)
			descLabel.Font = Enum.Font.Gotham
			descLabel.TextSize = 12
			descLabel.TextXAlignment = Enum.TextXAlignment.Left
			descLabel.Parent = btn

			if type(opts.Callback) == "function" then
				btn.MouseButton1Click:Connect(function()
					pcall(opts.Callback)
				end)
			end

			-- hover effect
			btn.MouseEnter:Connect(function()
				TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Color3.fromRGB(48,48,52)}):Play()
			end)
			btn.MouseLeave:Connect(function()
				TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Color3.fromRGB(40,40,44)}):Play()
			end)

			return btn
		end

		return public
	end

	-- expose a convenience: get list of tabs
	function Win:GetTabs()
		local out = {}
		for i, t in ipairs(self._Tabs) do
			table.insert(out, {Index = i, Button = t.Button, Page = t.Page})
		end
		return out
	end

	if typeof(Callback) == "function" then
		pcall(Callback)
	end

	return Win
end

return KazeUI
